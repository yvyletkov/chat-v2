(this.webpackJsonpchatroom=this.webpackJsonpchatroom||[]).push([[0],{117:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(54),s=a.n(c),o=(a(63),a(6)),u=a.n(o),l=a(9),m=a(5),i=a(1),E=(a(65),a(55)),p=a.n(E)()(),d=a(57),f=a(7),v=function(e,t){switch(t.type){case"SET-JOINED":return Object(f.a)(Object(f.a)({},e),{},{isJoined:!0,roomId:t.payload.roomId,userName:t.payload.userName});case"SET-DATA":return Object(f.a)(Object(f.a)({},e),{},{users:t.payload.users,messages:t.payload.messages});case"SET-USERS":return Object(f.a)(Object(f.a)({},e),{},{users:t.users});case"SET-NEW-MESSAGE":return Object(f.a)(Object(f.a)({},e),{},{messages:[].concat(Object(d.a)(e.messages),[t.payload])});default:return e}},b=a(10),g=a.n(b);var S=function(e){var t=e.onCreateRoom,a=r.a.useState(""),n=Object(m.a)(a,2),c=n[0],s=n[1],o=r.a.useState(!1),i=Object(m.a)(o,2),E=i[0],p=i[1],d=function(){var e=Object(l.a)(u.a.mark((function e(){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c){e.next=4;break}alert("\u0412\u0412\u0415\u0414\u0418\u0422\u0415 \u0418\u041c\u042f"),e.next=13;break;case 4:return p(!0),e.next=7,g.a.get("/create-room");case 7:a=e.sent,n=a.data.roomId,t({roomId:n,userName:c}),p(!1),window.history.pushState(null,"",n.toString());case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"join-block"},r.a.createElement("span",null,"Please, enter your name to create new room"),r.a.createElement("input",{onKeyPress:function(e){"Enter"===e.key&&(e.preventDefault(),d())},type:"text",placeholder:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f",value:c,onChange:function(e){s(e.target.value)}}),r.a.createElement("button",{disabled:E,onClick:d,className:"btn btn-success"},E?"...\u0412\u0425\u041e\u0414":"\u0412\u041e\u0419\u0422\u0418"))},y=function(e){var t=e.users,a=e.messages,n=e.userName,c=e.roomId,s=e.onAddNewMessage,o=r.a.useState(""),u=Object(m.a)(o,2),l=u[0],i=u[1],E=r.a.useRef();r.a.useEffect((function(){E.current.scrollTo(0,99999)}),[a]);var d=function(){var e=new Date,t=1===e.getHours().toString().length?"0"+e.getHours():e.getHours(),a=1===e.getMinutes().toString().length?"0"+e.getMinutes():e.getMinutes(),r="".concat(t,":").concat(a);p.emit("NEW-MESSAGE",{roomId:c,userName:n,text:l}),s({userName:n,text:l,time:r}),i("")};return r.a.createElement("div",{className:"chat"},r.a.createElement("div",{className:"chat-users"},r.a.createElement("h5",null,"RoomID: ",c),r.a.createElement("h5",null,"Your name: ",n),r.a.createElement("hr",null),r.a.createElement("h6",null,"Users (",t?t.length:"0","):"),r.a.createElement("ul",null,t?t.map((function(e,t){return r.a.createElement("li",{key:e+t},e)})):null)),r.a.createElement("div",{className:"chat-messages"},r.a.createElement("div",{ref:E,className:"messages"},a?a.map((function(e,t){return r.a.createElement("div",{key:t,className:"message"},r.a.createElement("div",{className:"message-body bg-primary"},e?e.text:null),r.a.createElement("div",null,r.a.createElement("span",null,e?e.time+" /":null),r.a.createElement("span",null,e?" "+e.userName:null)))})):null),r.a.createElement("form",null,r.a.createElement("textarea",{onKeyPress:function(e){"Enter"===e.key&&(e.preventDefault(),d())},value:l,onChange:function(e){i(e.target.value)}})),r.a.createElement("button",{onClick:d,className:"btn btn-primary"},"Send")))};var h=function(e){console.log("PROPS:",e);var t=+e.match.params.roomId,a=r.a.useState(""),n=Object(m.a)(a,2),c=n[0],s=n[1],o=r.a.useState(!1),i=Object(m.a)(o,2),E=i[0],p=i[1],d=r.a.useState(!1),f=Object(m.a)(d,2),v=f[0],b=f[1],S=function(){var a=Object(l.a)(u.a.mark((function a(){var n,r;return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c){a.next=4;break}alert("\u0412\u0412\u0415\u0414\u0418\u0422\u0415 \u0418\u041c\u042f"),a.next=11;break;case 4:return p(!0),a.next=7,g.a.get("/check-room/".concat(t));case 7:n=a.sent,n.data.roomExist?(r={roomId:t,userName:c},e.onJoinRoom(r),p(!1)):b(!0);case 11:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"join-block"},r.a.createElement("span",null,"You are invited to the room ",t),r.a.createElement("input",{onKeyPress:function(e){"Enter"===e.key&&(e.preventDefault(),S())},type:"text",placeholder:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f",value:c,onChange:function(e){s(e.target.value)}}),r.a.createElement("button",{onClick:S,className:"btn btn-success"},E?"...\u0412\u0425\u041e\u0414":"\u0412\u041e\u0419\u0422\u0418"),v&&r.a.createElement("span",null,"Room does not exist")))};var N=function(){var e=r.a.useReducer(v,{isJoined:!1,roomId:null,userName:null,users:[],messages:[]}),t=Object(m.a)(e,2),a=t[0],n=t[1],c=function(){var e=Object(l.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n({type:"SET-JOINED",payload:t}),p.emit("ROOM:JOIN",t),e.next=4,g.a.get("/rooms/".concat(t.roomId));case 4:a=e.sent,n({type:"SET-DATA",payload:a.data});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=Object(l.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n({type:"SET-JOINED",payload:t}),p.emit("ROOM:JOIN",t),e.next=4,g.a.get("/rooms/".concat(t.roomId));case 4:a=e.sent,n({type:"SET-DATA",payload:a.data});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(e){n({type:"SET-USERS",users:e})},E=function(e){n({type:"SET-NEW-MESSAGE",payload:e})};return r.a.useEffect((function(){p.on("SET-USERS",o),p.on("NEW-MESSAGE",E)}),[]),window.socket=p,console.log("state = ",a),a.isJoined?r.a.createElement("div",{className:"wrapper"},r.a.createElement(y,Object.assign({},a,{onAddNewMessage:E}))):r.a.createElement("div",{className:"wrapper"},r.a.createElement(i.a,{exact:!0,path:"/:roomId",render:function(e){return r.a.createElement(h,Object.assign({},e,{onJoinRoom:s}))}}),r.a.createElement(i.a,{exact:!0,path:"/",render:function(){return r.a.createElement(S,{onCreateRoom:c})}}))},O=a(26);s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(O.a,null,r.a.createElement(N,null))),document.getElementById("root"))},58:function(e,t,a){e.exports=a(117)},63:function(e,t,a){},65:function(e,t,a){},94:function(e,t){}},[[58,1,2]]]);
//# sourceMappingURL=main.c0c29709.chunk.js.map